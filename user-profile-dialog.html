<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-material/paper-material.html">

<link rel="import" href="../etools-dialog/etools-dialog.html">
<link rel="import" href="../etools-searchable-multiselection-menu/etools-single-selection-menu.html">
<link rel="import" href="../etools-searchable-multiselection-menu/etools-multi-selection-menu.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<dom-module id="user-profile-dialog">
  <template>
    <style>
      [hidden] {
        display: none !important;
      }

      :host {
        --etools-checkable-input-label: {
          font-size: 14px;
        };

        --paper-dialog-scrollable: {
          width: 100%;
          overflow-x: hidden;
          max-height: 600px;
        };
      }

      etools-checkable-input:not(:last-of-type) {
        margin-right: 30px;
      }

      paper-input,
      paper-material {
        width: 100%;
      }

      paper-material {
        padding: 0;
      }
      #profile-content {
        overflow: hidden;
        box-sizing: border-box;
        @apply --user-profile-dropdown-content;
      }
      .row-h {
        @apply --layout-horizontal;
      }
      .flex-c {
        /* flex container */
        @apply --layout-flex;
      }
      .row-h + .row-h, .row-v + .row-v {
        margin-top: 20px;
      }
      .row-h:first-child + .row-v {
        margin-top: 0;
      }
      .col {
        @apply --layout-horizontal;
        box-sizing: border-box;
      }
      .col:not(:first-child) {
        padding-left: 24px;
      }
      .col-12 {
        flex: 0 0 100%;
        max-width: 100%;
      }

    </style>

    <etools-dialog id="userProfileDialog" size="lg" ok-btn-text="Save" dialog-title="My Profile"
                   on-close="_closeUserProfileDialog">
      <div id="profile-content">
        <div class="row-h flex-c">
          <div class="col col-3">
            <paper-input id="name"
                          label="Name"
                          placeholder="&#8212;"
                          value="[[profile.name]]"
                          readonly>
            </paper-input>
          </div>
        </div>
        <div class="row-h flex-c">
          <div class="col col-12">
            <etools-multi-selection-menu id="workspaces"
                                         label="Available workspaces"
                                         placeholder="&#8212;"
                                         selected-values="[[availableCountryIds]]"
                                         options="[[profile.profile.countries_available]]"
                                         option-value="id"
                                         option-label="name"
                                         readonly>
            </etools-multi-selection-menu>
          </div>
        </div>
        <div class="row-h flex-c">
          <div class="col col-12">
            <etools-multi-selection-menu id="groups"
                                         label="My Groups"
                                         placeholder="&#8212;"
                                         selected-values="[[availableGroups]]"
                                         options="[[profile.groups]]"
                                         option-value="id"
                                         option-label="name"
                                         readonly>
            </etools-multi-selection-menu>
          </div>
        </div>
      </div>


      </div>
    </etools-dialog>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'user-profile-dialog',
        properties: {
          profile: {
            type: Object,
            notify: true
          },
          availableCountryIds: Array,
          availableGroups: Array
        },
        observers: [
          '_mapIds(profile)'
        ],
        openUserProfileDialog: function() {
          this.$.userProfileDialog.opened = true;
        },
        _closeUserProfileDialog: function(event) {
          if (event.detail.confirmed) {
            this.saveData();
          }
        },
        _mapIds: function(profile) {
          let availableCountryIds = _.map(this.profile.profile.countries_available, 'id');
          let availableGroups = _.map(this.profile.groups, 'id');

          this.set('availableCountryIds', availableCountryIds);
          this.set('availableGroups', availableGroups);
        },
        saveData: function() {
          this.fire('save-profile-data', {profile: this.profile});
        }
      });
    })();
  </script>
</dom-module>
